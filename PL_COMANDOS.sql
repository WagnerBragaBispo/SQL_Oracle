PL_COMANDOS='Dados atualizados até ' & Max({<DS_MES=,DS_ANO_MES=,AA_ANO=>}Date(DT_CALENDARIO,'DD/MM/YYYY'))AND UPPER(A.DSC_OBSERVACAO_ATENDIMENTO) LIKE '%MINHACLAROWEB%AUTENTICA%USU%'MC.DW_METODO_CONTATO IN (81, 411, 451,701) --EXPURGO 681 FLEX, 552 Minha Claro Empresa/*--MONITORAR USO DO BANCO DE DADOS*/SELECT * FROM ALL_ALL_TABLES WHERE OWNER LIKE 'U92047747';DELETE U92047747.BI_FT_RET_DIG_USSD WHERE DAT_REFERENCIA IN ('31/12/2019','29/02/2020','31/03/2020' );SELECT COUNT(*) SEGMENTS ,ROUND(SUM(BYTES)/1024/1024,2) SIZE_MB FROM USER_SEGMENTS; Para compress de tabelas: ALTER TABLE OWNER.NOMEDATABELA MOVE TABLESPACE NOMEDATABLESPACE parallel 32 nologging compress for query high ;Compress Partições: Alter table <<table_name>> move partition <<part_name>> compress for query high parallel 32;Para compress de tabelas:ALTER TABLE OWNER.NOMEDATABELA MOVE TABLESPACE NOMEDATABLESPACE parallel 32 nologging compress for query high ; Compress Partições:Alter table <<table_name>> move partition <<part_name>> compress for query high parallel 32;select table_name from dba_tab_columns where column_name='THE_COLUMN_YOU_LOOK_FOR'select * from all_tab_columns where column_name='DW_LOCAL_PAGAMENTO' AND OWNER = 'DWH'; COLUMN_NAMEselect * from all_tab_columns where column_name='DW_LOCAL_PAGAMENTO' AND OWNER = 'DWH';SELECT * FROM ALL_ALL_TABLES WHERE OWNER LIKE 'DWH' AND TABLE_NAME LIKE '%MINT%';COMPRESS --ALTER TABLE OWNER.NOMEDATABELA MOVE TABLESPACE NOMEDATABLESPACE parallel 32 nologging compress for query high ;ALTER TABLE U92047747.TMP_SQDAA_CMV_FAT_01 MOVE TABLESPACE TSPRD_USER_IND_ANALISE parallel 32 nologging compress for query high ;SELECT * FROM ALL_ALL_TABLES WHERE OWNER LIKE 'U92039197' AND TABLE_NAME LIKE '%AFETADO_BATCH_BOW%';---"black list" Fatura Digital LEONARDO FATURAMENTOFATURA DIGITAL WHATSAPP TRAKING 'DISPAROS GRAFICA' NATHALIE/*--==================================================================		DUPLICADO DUPLICATE--==================================================================*/SELECT IDM.sk_acesso  FROM TMP_SQDAA_DTH_RET_P2B IDM GROUP BY IDM.sk_acesso HAVING count(SK_ACESSO) > 1;/*SK_ACESSO 118003346 20200925 105808 136616649 20200925 105808 118003346 20200926 103235 158214358 20200914 093958 158214358 20200916 103245 158214358 20200914 094047 136616649 20200926 103235 158214358 20200920 120351*//*--==================================================================		CRIANDO DATAS--==================================================================*/SELECT  /*+parallel (32)*/ ------------------------------------------------------------------------ETAPA 2 BASE DE LIGACOES		TO_DATE(      ADD_MONTHS(              LAST_DAY(TO_DATE(&&DT_MOVIMENTO, 'YYYYMMDD')),-1)+1,'DD/MM/YYYY') AS DAT_MOVIMENTO      ,TO_NUMBER(                  TO_CHAR(                      (ADD_MONTHS(                            LAST_DAY(                                TO_DATE(&&DT_MOVIMENTO, 'YYYYMMDD')),-1)+1),'YYYYMMDD'))   AS SK_INI      ,TO_NUMBER(            TO_CHAR(                LAST_DAY(                    TO_DATE(&&DT_MOVIMENTO, 'YYYYMMDD')),'YYYYMMDD'))      AS SK_FIMFROM DUAL;/*RESULT 01/09/20	20200901	20200930*/--=================================================================-- EMAIL USERNAME--=================================================================SELECT REPLACE(REGEXP_SUBSTR ('braga.wag@gmail.com','^.*@'),'@','') USERNAMEFROM dual;--=================================================================-- CRIANDO UMA TABELA QUE FAZ VALIDAÇÃO OU CHECK DA VARIAVEL--=================================================================CREATE TABLE TB_TREINAMENTO(	"ID" NUMBER(5) NOT NULL,	"NOME" VARCHAR2(10),	"SEXO" CHAR(1));INSERT INTO TB_TREINAMENTO (ID,NOME,SEXO) VALUES (1,'WAGNER','M');ALTER TABLE "TB_TREINAMENTO" ADD CONSTRAINT "CK_TREINA_SEXO" CHECK (Sex in ('M','F')) ENABLE;ALTER TABLE "TB_TREINAMENTO" ADD CONSTRAINT "PK_TREINAMENTO" PRIMARY KEY ("ID") ENABLE;ALTER TABLE TB_TREINAMENTO	RENAME CONSTANT SYS_C004075 TO PK_TREINAMENTO_CT;	ALTER TABLE "TB_TREINAMENTO" DROP CONSTRAINT PK_TREINAMENTO_CT;--=================================================================-- Variáveis de substituição--=================================================================&(E comercial simples) -- valores temporários&&(duplo) --> reutizar o valor já definido na sessão--DEVEMOS EXECUTAR O COMANDO SET DEFINE ON;--=================================================================-- EXPORTAR TABELAS--=================================================================select /*csv*/        SUBSTR(TO_CHAR(20190901),1,6) AS DT ---SAFRA PLSQL      ,SUBSTR(TO_CHAR(20200601),1,6) AS DT2FROM DUAL;set DT offset DT2 onset colsep ';'spool 'mytab.csv'select * from tab;spool off--=================================================================-- grant nas tabelas--=================================================================Sintaxe para tabelasTipo de privilégio GRANT ON [TABLE] { nome da tabela | view-Name } para donatáriosSintaxe para rotinasEXECUTAR CONCESSÃO EM {FUNÇÃO | PROCEDIMENTO} rotina de designador TO bolsistasGRANT privilege-type ON [TABLE] { table-Name | view-Name } TO granteesSyntax for routinesGRANT EXECUTE ON { FUNCTION | PROCEDURE } routine-designator TO granteesGRANT SELECT ON [TABLE] TO PUBLICGRANT SELECT ON BUS_SQD_AA_BASE_CAD_CMV_DTL TO PUBLIC;CREATE TABLE TMP_SQDAA_DIM_MOT_ATH_URA COMPRESS FOR QUERY HIGH PARALLEL 256 NOLOGGING ASSELECT * FROM ALL_ALL_TABLES WHERE OWNER LIKE '%U92047747%'---TSPRD_USER_IND_ANALISE--=================================================================-- INSERT COM NOT EXISTS insert--=================================================================INSERT INTO clients(client_id, client_name, client_type)SELECT supplier_id, supplier_name, 'advertising'FROM suppliersWHERE NOT EXISTS (SELECT *                  FROM clients                  WHERE clients.client_id = suppliers.supplier_id);INSERT /*+APPEND */ INTO BUS_SQD_AA_BASE_CAD_CMV_AGGINSERT INTO TB_FUNCIONARIO (ID_FUNCIONARIO, SEXO, NOME)VALUES (12,'F', 'MARIA ANGELA');--=================================================================-- FORMATO DE DATA & FORMAT DATE--=================================================================TO_NUMBER(TO_CHAR(DAT_INICIO_ATENDIMENTO, 'RRRRMMDD')) SK_DATA --,TO_DATE(TO_CHAR(A.DAT_INICIO_ATENDIMENTO, 'RRRRMMDD')||' '||A.HOR_INICIO_ATENDIMENTO,'RRRRMMDD HH24MISS') DT_ATENDIMENTO ---DWH.BI_FP_ASSINANTE_ATEND_FECHADO       ,RPAD(HOR_INICIO_ATENDIMENTO, 2)                        HORA	   obter o início do primeiro dia do próximo mês, assim: (last_day(add_months(trunc(sysdate,'mm'),-1))+1)	   --=================================================================-- EXTRAIR DADOS DE UM CAMPO TEXTO--=================================================================AND TRIM(SUBSTR(A.NM_DESC_PEDIDO,INSTR(NM_DESC_PEDIDO,'|origem:')+8)) IN ('MINHANET','MEUTECNICO')	   --=================================================================-- EXTRAIR HORARIO DE UMA DATE DATETIME--=================================================================selectSUBSTR(to_char(sysdate,'dd/mm/yyyy hh24:mi:ss'),12,8)FROM dual	   -- selectREPLACE(SUBSTR(to_char(sysdate,'dd/mm/yyyy hh24:mi:ss'),12,8),':','')FROM dual--=================================================================(--LIMITAR NÚMERO DE REGISTROS--=================================================================	SELECT [COLUNA(S)] FROM [TABELA] WHERE ROWNUM < [NUMERO DE REGISTROS])--=================================================================(--junta cpf com cnpj--=================================================================TO_NUMBER(DECODE(TRIM(TRANSLATE(NR_CPF_CNPJ_ASSINANTE,'0123456789',' ')),NULL,NR_CPF_CNPJ_ASSINANTE,NULL)) NR_CPF_CNPJ_ASSINANTE,)--=================================================================(--extrair parte de uma string--=================================================================RPAD(HOR_INICIO_ATENDIMENTO, 2)                        HORA)select SUBSTR(TO_CHAR(20190901),1,6) AS DT ---SAFRA PLSQLFROM DUAL)--=================================================================(--Conexão DBlink--=================================================================DROP TABLE CMV_ASS_JUL_19CREATE TABLE CMV_ASS_JUL_19 COMPRESS FOR QUERY HIGH PARALLEL 32 PCTFREE 0 NOLOGGING ASSELECTNUM_NTCFROM OPS_ALTERYX.BI_FP_BASE_ASSINANTE_CMVWHERE COD_PLATAFORMA = 'AUTOC'AND DAT_MOVIMENTO = '01/08/2019'SELECT * FROM CMV_ASS_JUL_19--=================================================================(--Conexão DBlink--=================================================================---INN para DWHBI_DIM_METODO_CONTATO@BASECLARO BI_DIM_MOTIVO_ATENDIMENTO@BASECLARO---DWH para INNINN.DW_ASSINANTE_NET@RAC_INN)--=================================================================(--coversão de data--=================================================================BETWEEN TO_DATE(&DATA_INICIAL, 'RRRRMMDD') AND  TO_DATE(&DATA_FINAL, 'RRRRMMDD'))//='Dados atualizados até ' & Max( date(DT_CALENDARIO,'DD/MM/YYYY'))--=================================================================(--TABELAS NO SERVIDOR--=================================================================select * from ALL_TABLES where TABLE_NAME like '%PDD_%'select * from ALL_TABLES where OWNER like '%BISDBX%' ORDER BY LAST_ANALYZED DESCselect * from ALL_ALL_TABLES where owner like '%T6137207')--=================================================================(--CONSULTA PRINT LASER - Leonardo--=================================================================SELECT A.NUM_NTC        ,CLI.NUM_CPF       ,FAT.* FROM DWH.BI_DIM_CLIENTE CLI LEFT JOIN OPS_ALTERYX.BI_FP_BASE_ASSINANTE_CMV A     ON A.DW_NUM_CLIENTE = CLI.DW_NUM_CLIENTELEFT JOIN U92039197.CRITICA_FATURAMENTO FAT     ON CLI.NUM_CPF = FAT.CPFWHERE A.DAT_MOVIMENTO = TO_DATE('01/07/2019','DD/MM/YYYY')      AND FAT.DATA BETWEEN TO_DATE('01/07/2019','DD/MM/YYYY') AND TO_DATE('31/07/2019','DD/MM/YYYY')      AND A.NUM_NTC IN (89994519381, 84991689270, 61992322367, 87999584063, 88997296319, 21990860738, 86994334671, 84991226660, 83993856627, 85992059166, 88992338469, 62992819360, 87992068096, 83991762588, 83993972928, 65992811695, 84992166100, 61991658287, 21966958277)	 	)OperadoresDiferente <> ou !=--=================================================================(--CONSULTA USSD--================================================================= SELECT        DISTINCT(NUM_NTC),       DAT_FIM_ATENDIMENTOFROM DWH.BI_FP_ATENDIMENTO_MINTWHERE COD_SHORT_CODE = '1052'AND COD_PLATAFORMA = 'AUTOC' ---AUTOC significa Claro ControleAND DAT_REFERENCIA BETWEEN TO_DATE('20190501', 'RRRRMMDD') AND TO_DATE('20190731', 'RRRRMMDD')  --=================================================================(--CONTAGEM DE CONTRATOS ----- --=================================================================   COUNT(DISTINCT CF.NUM_CONTRATO) QTD_CONTRATOS    )--=================================================================(--CONVERT DE VALORES ----- --=================================================================create table cca_car_gd_201608 (nr_contrato varchar2(15),cd_operadora varchar2 (15),valor varchar2 (15))select sum(replace(valor,'.',',')) from cca_car_gd_201608)--=================================================================(--MODELO UNION ----- --=================================================================SELECT       TRUNC(SYSDATE - 1) DT_FOTO,             A.*,CASE         WHEN A.SALDO_ANT = 0 THEN 'NOVO'             WHEN A.VARIACAO > 0 THEN 'AUMENTO'             WHEN A.VARIACAO < 0 THEN 'REDUCAO' ELSE 'XXX' END STATUS_SALDOFROM         DCCA_VARIACAO AWHERE        VARIACAO <>0UNION ALLSELECT       TRUNC(SYSDATE - 1) DT_FOTO,             B.*, 'SAIU' STATUS_SALDOFROM         DCCA_VARIACAO_S BCOMMIT)--=================================================================SELECT         TO_DATE(AE.SK_DATA,'YYYYMMDD') AS SK_DATA         ,AE.MM_REFERENCIA         ,SUM(AE.VL_AGING_AV) AS VL_AGING_AV         ,SUM(AE.VL_AGING_30) AS VL_AGING_30         ,SUM(AE.VL_AGING_60)AS VL_AGING_60         ,SUM(AE.VL_AGING_90) AS VL_AGING_90         ,SUM(AE.VL_AGING_120)AS VL_AGING_120         ,SUM(AE.VL_AGING_180) AS VL_AGING_180         ,SUM(AE.VL_AGING_180) AS VL_AGING_180         ,SUM(AE.VL_TITULOS_EMITIDOS) AS VL_TITULOS_EMITIDOS         ,SUM(AE.VL_NAO_RECEBIVEL) AS VL_NAO_RECEBIVEL         ,SUM(AE.VL_AGING_A90) AS VL_AGING_A90         ,SUM(AE.VL_SALDO_PROV_NR_M0) AS VL_SALDO_PROV_NR_M0         ,SUM(AE.VL_SALDO_PROV_NR_M1) AS VL_SALDO_PROV_NR_M1         ,SUM(AE.VL_PDD_ASSINATURA) AS VL_PDD_ASSINATURA         ,SUM(AE.VL_PREVISAO_LF) AS VL_PREVISAO_LFFROM     DWH.AG_CALC_PDD_AE AEWHERE    AE.SK_DATA > 20170400AND      AE.CD_CID_CONTRATO <> '-1'GROUP BY AE.SK_DATA,AE.MM_REFERENCIAORDER BY AE.SK_DATA DESCSELECT    MOV.*          ,CAR.SK_FXA_AGING_FECHAMENTO AS FX_FECHO_ANT          ,(CAR_ATU.AGED_ATU)*1 AS FX_FECHO_ATU          ,NVL(CAR.VL_FINAL,0) AS SALDO_FECHO_ANT          ,NVL(CAR_ATU.VL_FINAL,0) AS SALDO_FECHO_ATU          ,NVL(CAR_ATU.VL_FINAL,0) - NVL(CAR.VL_FINAL,0) AS VAR_ATU           FROM      MOV_OVER_AGED MOVLEFT JOIN DCCA_CAR_201704 CAR     ON   MOV.NR_CONTRATO = CAR.NR_CONTRATO     AND  MOV.CD_OPERADORA = CAR.CD_OPERADORA     LEFT JOIN DCCA_CAR_201705 CAR_ATU      ON   MOV.NR_CONTRATO = CAR_ATU.NR_CONTRATO     AND  MOV.CD_OPERADORA = CAR_ATU.CD_OPERADORAWHERE MOV.DT_FOTO IN ('01/06/2017')----DCCA_CAR_TEC_M1_P2  car do dia 24/04/2017 envelhecidoSELECT        ATU.NR_CONTRATO AS NR_CONTRATO             ,ATU.CD_OPERADORA AS CD_OPERADORA             ,ATU.DS_FXA_AGING AS FX_AGING_ATU             ,ANT.DS_FXA_AGING AS FX_AGING_ANT             ,NVL(ATU.VL_FINAL,0) AS SALDO_ATU             ,NVL(ANT.VL_FINAL,0) AS SALDO_ANT             ,NVL(ATU.VL_FINAL,0) - NVL(ANT.VL_FINAL,0) AS VARIACAO FROM          DCCA_OVER90ATU ATU             ,DCCA_OVER90ANT ANTWHERE         ATU.NR_CONTRATO = ANT.NR_CONTRATO (+)--=================================================================(UPDATE DADOS DE UMA TABELA--=================================================================UPDATE TB_LIVRO SET PRECO=80,EDICAO=3WHERE ID_LIVRO=15UPDATE TB_LIVRO SET PRECO=(SELECT PRECO FROM TB_LIVRO WHERE TITULO='REDES DE COMPUTADORES')WHERE PRECO BETWEEN 10 AND 15;ROLLBACK -- REFAZ O INSERT --=================================================================(--CONCATENAR ----- STRING--=================================================================CONCAT('Tech on', ' the Net')Result: 'Tech on the Net'CONCAT('a', 'b')Result: 'ab'--CONCATENAR COM CASE WHEN E RETIRA OS ESPAÇOS VAZIOregexp_replace(TO_CHAR(M.COD_MOTIVO_ATEND_NIVEL_1,'00000')||                        TO_CHAR(M.COD_MOTIVO_ATEND_NIVEL_2,'00000')||                         TO_CHAR(M.COD_MOTIVO_ATEND_NIVEL_3,'00000'),'[[:space:]]*','')||               (CASE WHEN M.COD_MOTIVO_ATEND_NIVEL_4 = -3 THEN '00000'                      ELSE (regexp_replace(TO_CHAR(M.COD_MOTIVO_ATEND_NIVEL_4,'00000'),'[[:space:]]*',''))END)||                (CASE WHEN M.COD_MOTIVO_ATEND_NIVEL_5 = -3 THEN '00000'                       ELSE (regexp_replace(TO_CHAR(M.COD_MOTIVO_ATEND_NIVEL_5,'00000'),'[[:space:]]*',''))END)                            AS ID_MOTIVOS_TUPLA						   to_date(LPAD(to_char(car.datacompra), 8,'0'),'yyyymmdd')SQL> -- generating sample dataSQL> with t as (  2  select 'AAA    BBB CCC' col from dual union  3  select 'DDDD EEE     F' col from dual   4  )  5  --  6  -- actual query:  7  --  8  select regexp_replace(col, '[[:space:]]+', chr(32)) col  9  from   t    SQL> select replace('AAA BBB CCC', chr(32), '') from dual						   )--=================================================================(--CALCULAR VARIAÇÃO DE DOIS CAMPOS--=================================================================CREATE TABLE  DCCA_VARIACAO ASSELECT        ATU.NR_CONTRATO AS NR_CONTRATO             ,ATU.CD_OPERADORA AS CD_OPERADORA             ,ATU.FX_AGING AS FX_AGING_ATU             ,ANT.FX_AGING AS FX_AGING_ANT             ,NVL(ATU.SALDO,0) AS SALDO_ATU             ,NVL(ANT.SALDO,0) AS SALDO_ANT             ,NVL(ATU.SALDO,0) - NVL(ANT.SALDO,0) AS VARIACAO FROM          DCCA_OVER90ATU ATU             ,DCCA_OVER90ANT ANTWHERE         ATU.NR_CONTRATO = ANT.NR_CONTRATO (+)AND           ATU.CD_OPERADORA = ANT.CD_OPERADORA (+))(SELECT ROUND(AVG(PC_MUNICIPIO),4) AS PC_MED_MUN_12M                          FROM DWH.AG_PERC_PERDAS R1                         WHERE TO_CHAR(TO_DATE(SK_DATA,'YYYYMMDD'),'YYYYMM')                         BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE('#8_ENTERPRISE.VRB_DT_LOAD_PDD_FULL_INI', 'DD/MM/YYYY'),-11),'YYYYMM')                        AND                         TO_CHAR(TO_DATE('#8_ENTERPRISE.VRB_DT_LOAD_PDD_FULL_INI', 'DD/MM/YYYY'),'YYYYMM')                        AND R1.SK_MUNICIPIO = R.SK_MUNICIPIO                       )(--- FECHO PDD--=================================================================--TABELA COM O OVER 90 DDO MÊS ANTERIOR ----- INÍCIO--=================================================================SELECT /*+PARALLEL (30)*/        CTA_FIN.NR_CONTRATO,       FX_AGING.DS_FXA_AGING,       MUN.NM_MUNICIPIO,       OPER.CD_OPERADORA,       FT.*  FROM DWH.FT_AGING  FTLEFT JOIN  --SELECT * FROM       DWH.DS_CTA_FINANCEIRA  CTA_FIN   ON FT.SK_CTA_FINANCEIRA = CTA_FIN.SK_CTA_FINANCEIRALEFT JOIN        DWH.DS_FXA_AGING  FX_AGING   ON FT.SK_FXA_AGING_FECHAMENTO = FX_AGING.SK_FXA_AGINGLEFT JOIN        DWH.DS_MUNICIPIO  MUN   ON FT.CD_MUN_IBGE = MUN.SK_MUNICIPIO    AND MUN.FC_STATUS = 'A'LEFT JOIN       DWH.DW_SN_CID_OPERADORA  OPER   ON FT.CD_CID_CONTRATO = OPER.CD_CIDADE   AND OPER.DT_FIM_VIGENCIA = '31/12/2100'WHERE FT.SK_DATA = '20160901'--=================================================================--TABELA COM O OVER 90 DDO MÊS ANTERIOR ----- FIM--=================================================================)(--TESTE DE AGING LF + FAT = FECHO ----- INÍCIO--=================================================================--TESTE DE AGING LF + FAT = FECHO ----- INÍCIO--=================================================================--- CASE WHEN ---CREATE TABLE TMP_REGRA_AGING ASSELECT /*+PARALLEL (30)*/       FT.SK_FXA_AGING_FECHAMENTO FX_ORIGINAL,      FT.QT_DIAS_AGING_FAT,      FT.QT_DIAS_AGING_LF,      CASE         WHEN      (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) <= 0 THEN '1'       WHEN      (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) >  0      AND       (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) <  31 THEN '2'     WHEN      (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) >  30      AND       (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) <  61 THEN '3'        WHEN      (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) >  60      AND       (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) <  91 THEN '4'             WHEN      (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) >  90      AND       (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) <  121 THEN '5'           WHEN      (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) >  120      AND       (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) <  151 THEN '6'           WHEN      (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) >  150      AND       (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) <  181 THEN '7'                WHEN      (CASE WHEN FT.QT_DIAS_AGING_LF > FT.QT_DIAS_AGING_FAT THEN FT.QT_DIAS_AGING_LF  ELSE FT.QT_DIAS_AGING_FAT END) >  180 THEN '8' ELSE 'XXX'      END FX_ORIGINAL2       FROM DWH.FT_AGING  FTLEFT JOIN  --SELECT * FROM       DWH.DS_CTA_FINANCEIRA  CTA_FIN   ON FT.SK_CTA_FINANCEIRA = CTA_FIN.SK_CTA_FINANCEIRA LEFT JOIN        DWH.DS_FXA_AGING  FX_AGING   ON FT.SK_FXA_AGING_FECHAMENTO = FX_AGING.SK_FXA_AGING LEFT JOIN        DWH.DS_MUNICIPIO  MUN   ON FT.CD_MUN_IBGE = MUN.SK_MUNICIPIO    AND MUN.FC_STATUS = 'A' LEFT JOIN       DWH.DW_SN_CID_OPERADORA  OPER   ON FT.CD_CID_CONTRATO = OPER.CD_CIDADE   AND OPER.DT_FIM_VIGENCIA = '31/12/2100'WHERE FT.SK_DATA = '20160905'--=================================================================--TESTE DE AGING LF + FAT = FECHO ----- FIM--=================================================================)(---MOV. OVER 90 DIAS--=================================================================--TABELA COM O OVER 90 DDO MÊS ANTERIOR--=================================================================DROP TABLE    DCCA_OVER90ANTCREATE TABLE  DCCA_OVER90ANT ASSELECT       /*+PARALLEL (30)*/               CTA_FIN.NR_CONTRATO AS NR_CONTRATO             ,MAX(FX_AGING.DS_FXA_AGING) AS FX_AGING             ,OPER.CD_OPERADORA AS CD_OPERADORA             ,SUM(FT.VL_FINAL) AS SALDOFROM          DWH.FT_AGING  FTLEFT JOIN     DWH.DS_CTA_FINANCEIRA  CTA_FINON            FT.SK_CTA_FINANCEIRA = CTA_FIN.SK_CTA_FINANCEIRALEFT JOIN     DWH.DS_FXA_AGING  FX_AGINGON            FT.SK_FXA_AGING_FECHAMENTO = FX_AGING.SK_FXA_AGINGLEFT JOIN     DWH.DS_MUNICIPIO  MUNON            FT.CD_MUN_IBGE = MUN.SK_MUNICIPIO AND           MUN.FC_STATUS = 'A'LEFT JOIN     DWH.DW_SN_CID_OPERADORA  OPERON            FT.CD_CID_CONTRATO = OPER.CD_CIDADEAND           OPER.DT_FIM_VIGENCIA = '31/12/2100'WHERE         FT.SK_DATA = '20161101'AND           FT.SK_FXA_AGING >= 5GROUP BY      CTA_FIN.NR_CONTRATO,              OPER.CD_OPERADORA                     SELECT        SUM(SALDO) FROM DCCA_OVER90ANT  --1.262.857.974,3--=================================================================--TABELA COM O OVER 90 DDO MÊS ATUAL--=================================================================DROP TABLE    DCCA_OVER90ATUCREATE TABLE  DCCA_OVER90ATU ASSELECT       /*+PARALLEL (30)*/               CTA_FIN.NR_CONTRATO AS NR_CONTRATO             ,MAX(FX_AGING.DS_FXA_AGING) AS FX_AGING             ,OPER.CD_OPERADORA AS CD_OPERADORA             ,SUM(FT.VL_FINAL) AS SALDOFROM          DWH.FT_AGING  FTLEFT JOIN     DWH.DS_CTA_FINANCEIRA  CTA_FINON            FT.SK_CTA_FINANCEIRA = CTA_FIN.SK_CTA_FINANCEIRALEFT JOIN     DWH.DS_FXA_AGING  FX_AGINGON            FT.SK_FXA_AGING_FECHAMENTO = FX_AGING.SK_FXA_AGINGLEFT JOIN     DWH.DS_MUNICIPIO  MUNON            FT.CD_MUN_IBGE = MUN.SK_MUNICIPIO AND           MUN.FC_STATUS = 'A'LEFT JOIN     DWH.DW_SN_CID_OPERADORA  OPERON            FT.CD_CID_CONTRATO = OPER.CD_CIDADEAND           OPER.DT_FIM_VIGENCIA = '31/12/2100'WHERE         FT.SK_DATA = '20161108'AND           FT.SK_FXA_AGING >= 5GROUP BY      CTA_FIN.NR_CONTRATO,              OPER.CD_OPERADORA                ---SELECT        SUM(SALDO) FROM DCCA_OVER90ATU  --1.259.333.976,15 --1.256.937.525,32 04/10--=================================================================--TABELA COM AS VARIAÇÕES--=================================================================DROP TABLE    DCCA_VARIACAOCREATE TABLE  DCCA_VARIACAO ASSELECT        ATU.NR_CONTRATO AS NR_CONTRATO             ,ATU.CD_OPERADORA AS CD_OPERADORA             ,ATU.FX_AGING AS FX_AGING_ATU             ,ANT.FX_AGING AS FX_AGING_ANT             ,NVL(ATU.SALDO,0) AS SALDO_ATU             ,NVL(ANT.SALDO,0) AS SALDO_ANT             ,NVL(ATU.SALDO,0) - NVL(ANT.SALDO,0) AS VARIACAO FROM          DCCA_OVER90ATU ATU             ,DCCA_OVER90ANT ANTWHERE         ATU.NR_CONTRATO = ANT.NR_CONTRATO (+)AND           ATU.CD_OPERADORA = ANT.CD_OPERADORA (+)--=================================================================--TABELA COM AS VARIAÇÕES (SAÍRAM)--=================================================================  DROP TABLE    DCCA_VARIACAO_SCREATE TABLE  DCCA_VARIACAO_S ASSELECT        ANT.NR_CONTRATO AS NR_CONTRATO             ,ANT.CD_OPERADORA AS CD_OPERADORA             ,ANT.FX_AGING AS FX_AGING_ATU             ,ANT.FX_AGING AS FX_AGING_ANT             ,NVL(ATU.SALDO,0) AS SALDO_ATU             ,NVL(ANT.SALDO,0) AS SALDO_ANT             ,NVL(ATU.SALDO,0) - NVL(ANT.SALDO,0) AS VARIACAO FROM          DCCA_OVER90ATU ATU             ,DCCA_OVER90ANT ANTWHERE        ATU.NR_CONTRATO (+)= ANT.NR_CONTRATO AND          ATU.CD_OPERADORA  (+)= ANT.CD_OPERADORAAND          ATU.NR_CONTRATO IS NULL         INSERT INTO  DCCA_MOV_SALDO SELECT       TRUNC(SYSDATE - 1) DT_FOTO,             A.*,CASE         WHEN A.SALDO_ANT = 0 THEN 'NOVO'             WHEN A.VARIACAO > 0 THEN 'AUMENTO'             WHEN A.VARIACAO < 0 THEN 'REDUCAO' ELSE 'XXX' END STATUS_SALDOFROM         DCCA_VARIACAO AWHERE        VARIACAO <>0UNION ALLSELECT       TRUNC(SYSDATE - 1) DT_FOTO,             B.*, 'SAIU' STATUS_SALDOFROM         DCCA_VARIACAO_S BCOMMIT)(---MOV. RESUMO OVER 90 DIAS--=================================================================--               Script: Movimentação do Over 90 dias - resumo--=================================================================SELECT DISTINCT DT_FOTO, STATUS_SALDO,SUM (SALDO_ATU) AS "TT_SALDO_ATU",SUM (SALDO_ANT) AS "TT_SALDO_ANT",SUM (VARIACAO) AS "TT_VARIACAO"FROM DCCA_MOV_SALDO   WHERE DT_FOTO = '01/12/2016' GROUP BY DT_FOTO, STATUS_SALDO ORDER BY DT_FOTO, STATUS_SALDO ASC SELECT SUM(SALDO) FROM DCCA_OVER90ATUSELECT SUM(SALDO) FROM DCCA_OVER90ANT)(---ESTUDO THOMPSON IMPACTO LF AGING ---- INÍCIO--=================================================================--ESTUDO THOMPSON IMPACTO LF AGING ---- INÍCIO--=================================================================  CREATE TABLE TMP_DCCA_PDD_201609_P1 ASSELECT /*+PARALLEL (30)*/        CTA_FIN.NR_CONTRATO,       FX_AGING.DS_FXA_AGING,       MUN.NM_MUNICIPIO,       OPER.CD_OPERADORA,       FT.*,     CASE         WHEN   --	   (CASE WHEN FT.QT_DIAS_AGING_FAT = 0 THEN FT.SK_FXA_AGING_FECHAMENTO  ELSE FT.QT_DIAS_AGING_FAT END)              (CASE WHEN FT.QT_DIAS_AGING_FAT < 0 THEN FT.QT_DIAS_AGING_FAT ELSE FT.QT_DIAS_AGING_FAT END) < 0 THEN '1'       WHEN      (CASE WHEN FT.QT_DIAS_AGING_FAT >= 1 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) >= 1       AND       (CASE WHEN FT.QT_DIAS_AGING_FAT <= 30 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) <= 30 THEN '2'     WHEN      (CASE WHEN FT.QT_DIAS_AGING_FAT >= 31 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) >= 31       AND       (CASE WHEN FT.QT_DIAS_AGING_FAT <= 60 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) <= 60 THEN '3'     WHEN     (CASE WHEN FT.QT_DIAS_AGING_FAT >= 61 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) >= 61       AND       (CASE WHEN FT.QT_DIAS_AGING_FAT <= 90 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) <= 90 THEN '4'     WHEN       (CASE WHEN FT.QT_DIAS_AGING_FAT >= 91 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) >= 91       AND       (CASE WHEN FT.QT_DIAS_AGING_FAT <= 120 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) <= 120 THEN '5'     WHEN       (CASE WHEN FT.QT_DIAS_AGING_FAT >= 121 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) >= 121       AND       (CASE WHEN FT.QT_DIAS_AGING_FAT <= 150 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) <= 150 THEN '6'     WHEN         (CASE WHEN FT.QT_DIAS_AGING_FAT >= 151 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) >= 151       AND       (CASE WHEN FT.QT_DIAS_AGING_FAT <= 180 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) <= 180 THEN '7'     WHEN        (CASE WHEN FT.QT_DIAS_AGING_FAT > 180 THEN FT.QT_DIAS_AGING_FAT  ELSE FT.QT_DIAS_AGING_FAT END) > 180 THEN '8' ELSE 'XXXX'      END SK_FXA_AGING_FECHAMENTO2                FROM DWH.FT_AGING FTLEFT JOIN         DWH.DS_CTA_FINANCEIRA  CTA_FIN   ON FT.SK_CTA_FINANCEIRA = CTA_FIN.SK_CTA_FINANCEIRA LEFT JOIN        DWH.DS_FXA_AGING  FX_AGING   ON FT.SK_FXA_AGING_FECHAMENTO = FX_AGING.SK_FXA_AGING LEFT JOIN        DWH.DS_MUNICIPIO  MUN   ON FT.CD_MUN_IBGE = MUN.SK_MUNICIPIO    AND MUN.FC_STATUS = 'A' LEFT JOIN       DWH.DW_SN_CID_OPERADORA  OPER   ON FT.CD_CID_CONTRATO = OPER.CD_CIDADE   AND OPER.DT_FIM_VIGENCIA = '31/12/2100'WHERE FT.SK_DATA = '20161001'----SELECT * FROM TMP_DCCA_PDD_201610_P1S------------------------------- CREATE TABLE TMP_DCCA_PDD_201610_P2 ASSELECT DISTINCT SK_FXA_AGING_FECHAMENTO2,       SUM (VL_FINAL) AS "TT_SALDO_ATU"              FROM TMP_DCCA_PDD_201609_P1 GROUP BY SK_FXA_AGING_FECHAMENTO2 ORDER BY SK_FXA_AGING_FECHAMENTO2 ASC )(---EXEMPLO DE CRIAÇÃO DE TABELAS--=================================================================--               Example: Creating a Table--=================================================================When you issue the following statement, you create a table named admin_emp in the hr schema and store it in the admin_tbs tablespace: CREATE TABLE hr.admin_emp (         empno      NUMBER(5) PRIMARY KEY,         ename      VARCHAR2(15) NOT NULL,         ssn        NUMBER(9) ENCRYPT,         job        VARCHAR2(10),         mgr        NUMBER(5),         hiredate   DATE DEFAULT (sysdate),         photo      BLOB,         sal        NUMBER(7,2),         hrly_rate  NUMBER(7,2) GENERATED ALWAYS AS (sal/2080),         comm       NUMBER(7,2),         deptno     NUMBER(3) NOT NULL                     CONSTRAINT admin_dept_fkey REFERENCES hr.departments                     (department_id))   TABLESPACE admin_tbs   STORAGE ( INITIAL 50K)COMMENT ON TABLE hr.admin_emp IS 'Enhanced employee table')( --- MOV. PRE PDD > DIEGO --=================================================================			-- SCRIPT MOVIMENTAÇÕES DA PPRE PDD 			----TABELA PRE PDD MÊS ANTERIOR						---INÍCIO--=================================================================DROP TABLE    DCCA_PREPDD_ANTCREATE TABLE  DCCA_PREPDD_ANT ASSELECT       /*+PARALLEL (30)*/               CTA_FIN.NR_CONTRATO AS NR_CONTRATO             ,MAX(FX_AGING.DS_FXA_AGING) AS FX_AGING             ,OPER.CD_OPERADORA AS CD_OPERADORA             ,SUM(FT.VL_FINAL) AS SALDOFROM          DWH.FT_AGING  FTLEFT JOIN     DWH.DS_CTA_FINANCEIRA  CTA_FINON            FT.SK_CTA_FINANCEIRA = CTA_FIN.SK_CTA_FINANCEIRALEFT JOIN     DWH.DS_FXA_AGING  FX_AGINGON            FT.SK_FXA_AGING_FECHAMENTO = FX_AGING.SK_FXA_AGINGLEFT JOIN     DWH.DS_MUNICIPIO  MUNON            FT.CD_MUN_IBGE = MUN.SK_MUNICIPIO AND           MUN.FC_STATUS = 'A'LEFT JOIN     DWH.DW_SN_CID_OPERADORA  OPERON            FT.CD_CID_CONTRATO = OPER.CD_CIDADEAND           OPER.DT_FIM_VIGENCIA = '31/12/2100'WHERE         FT.SK_DATA = '20161101'AND           FT.SK_FXA_AGING = 4GROUP BY      CTA_FIN.NR_CONTRATO,              OPER.CD_OPERADORA                     ---SELECT        SUM(SALDO) FROM DCCA_PREPDD_ANT 66.136859,2/Out_16--=================================================================--TABELA PRE PDD MÊS ATUAL--=================================================================DROP TABLE    DCCA_PREPDD_ATUCREATE TABLE  DCCA_PREPDD_ATU ASSELECT       /*+PARALLEL (30)*/               CTA_FIN.NR_CONTRATO AS NR_CONTRATO             ,MAX(FX_AGING.DS_FXA_AGING) AS FX_AGING             ,OPER.CD_OPERADORA AS CD_OPERADORA             ,SUM(FT.VL_FINAL) AS SALDOFROM          DWH.FT_AGING  FTLEFT JOIN     DWH.DS_CTA_FINANCEIRA  CTA_FINON            FT.SK_CTA_FINANCEIRA = CTA_FIN.SK_CTA_FINANCEIRALEFT JOIN     DWH.DS_FXA_AGING  FX_AGINGON            FT.SK_FXA_AGING_FECHAMENTO = FX_AGING.SK_FXA_AGINGLEFT JOIN     DWH.DS_MUNICIPIO  MUNON            FT.CD_MUN_IBGE = MUN.SK_MUNICIPIO AND           MUN.FC_STATUS = 'A'LEFT JOIN     DWH.DW_SN_CID_OPERADORA  OPERON            FT.CD_CID_CONTRATO = OPER.CD_CIDADEAND           OPER.DT_FIM_VIGENCIA = '31/12/2100'WHERE         FT.SK_DATA = '20161130'AND           FT.SK_FXA_AGING = 4GROUP BY      CTA_FIN.NR_CONTRATO,              OPER.CD_OPERADORA                ---SELECT        SUM(SALDO) FROM DCCA_PREPDD_ATU--=================================================================--TABELA COM AS VARIAÇÕES PREPDD--=================================================================DROP TABLE    DCCA_VARIACAO_PREPDDCREATE TABLE  DCCA_VARIACAO_PREPDD ASSELECT        ATU.NR_CONTRATO AS NR_CONTRATO             ,ATU.CD_OPERADORA AS CD_OPERADORA             ,ATU.FX_AGING AS FX_AGING_ATU             ,ANT.FX_AGING AS FX_AGING_ANT             ,NVL(ATU.SALDO,0) AS SALDO_ATU             ,NVL(ANT.SALDO,0) AS SALDO_ANT             ,NVL(ATU.SALDO,0) - NVL(ANT.SALDO,0) AS VARIACAO FROM          DCCA_PREPDD_ATU ATU             ,DCCA_PREPDD_ANT ANTWHERE         ATU.NR_CONTRATO = ANT.NR_CONTRATO (+)AND           ATU.CD_OPERADORA = ANT.CD_OPERADORA (+)--=================================================================--TABELA COM AS VARIAÇÕES (SAÍRAM)--=================================================================  DROP TABLE    DCCA_VARIACAO_PREPDD_SCREATE TABLE  DCCA_VARIACAO_PREPDD_S ASSELECT        ANT.NR_CONTRATO AS NR_CONTRATO             ,ANT.CD_OPERADORA AS CD_OPERADORA             ,ANT.FX_AGING AS FX_AGING_ATU             ,ANT.FX_AGING AS FX_AGING_ANT             ,NVL(ATU.SALDO,0) AS SALDO_ATU             ,NVL(ANT.SALDO,0) AS SALDO_ANT             ,NVL(ATU.SALDO,0) - NVL(ANT.SALDO,0) AS VARIACAO FROM          DCCA_PREPDD_ATU ATU             ,DCCA_PREPDD_ANT ANTWHERE        ATU.NR_CONTRATO (+)= ANT.NR_CONTRATO AND          ATU.CD_OPERADORA  (+)= ANT.CD_OPERADORAAND          ATU.NR_CONTRATO IS NULL    INSERT INTO  DCCA_MOV_PREPDDSELECT       TRUNC(SYSDATE - 1) DT_FOTO,             A.*,CASE         WHEN A.SALDO_ANT = 0 THEN 'NOVO'             WHEN A.VARIACAO > 0 THEN 'AUMENTO'             WHEN A.VARIACAO < 0 THEN 'REDUCAO' ELSE 'XXX' END STATUS_SALDOFROM         DCCA_VARIACAO_PREPDD AWHERE        VARIACAO <>0UNION ALLSELECT       TRUNC(SYSDATE - 1) DT_FOTO,             B.*, 'SAIU' STATUS_SALDOFROM         DCCA_VARIACAO_PREPDD_S BCOMMIT   )( --- MOV. PRE PDD - RESUMO  --=================================================================--               Script: Movimentação PRÉ PDD - resumo--=================================================================SELECT DISTINCT DT_FOTO, STATUS_SALDO,SUM (SALDO_ATU) AS "TT_SALDO_ATU",SUM (SALDO_ANT) AS "TT_SALDO_ANT",SUM (VARIACAO) AS "TT_VARIACAO"FROM DCCA_MOV_PREPDD   WHERE DT_FOTO = '01/12/2016' GROUP BY DT_FOTO, STATUS_SALDO ORDER BY DT_FOTO, STATUS_SALDO ASC    SELECT SUM(SALDO) FROM DCCA_OVER90ATUSELECT SUM(SALDO) FROM DCCA_OVER90ANT )  (--ESTUDO THOMPSON CAR CLIENTES EM ACORDO ---- INÍCIO --=================================================================--ESTUDO THOMPSON CAR CLIENTES EM ACORDO ---- INÍCIO--=================================================================  -OBEJTIVO MARCAR TODOS OS CONTRATOS QUE ESTÃO EM ACORDO/PROMESSA DE PAGAMENTO --=================================================================-- TABELAS AGREGADAS - PDD TECNICA--=================================================================  FT_AGING_FATURASFT_AGING_PGTOAG_CALC_PDDAG_CALC_PDD_AEAG_PERDA_REALAG_PERC_PERDASAG_VAR_DIARIA_PDDAG_AGING_COBR_PAGAG_AGING_COBR_BAIXA)(---CLARO TV > SCRIPT > FECHO E FORECAST ---- INÍCIO--=================================================================--CLARO TV > SCRIPT > FECHO E FORECAST ---- INÍCIO--=================================================================  --========= PROCESSO DE IMPORTAÇÃO DAS BASES DO CLARO FONE =============-- 1) Colar a base que será importada no banco no seguinte local: C:\PDD\Claro_TV\Loader-- 2) Renomear a base para vsms_ext_aging_DTH.txt-- 3) Alterar a data da foto no arquivo C:\PDD\Claro_TV\Loader\Loader_Claro_TV.ctr-- 4) Alterar as datas (11 datas somente na abertura do mês) no arquivo C:\PDD\Claro_TV\Loader\Insert_Car_Claro_TV_hst_agg.sql-- 5) Executar o arquivo Loader_Claro_TV.bat. O loader (carregamento no banco de dados) será iniciado-- 6) O processo enviará um e-mail quando o loader estiver finalizado e outro e-mail quando o insert estiver finalizado--Arquivo de fechamento:-- 7) CREATE TABLE INTCOB_CAR_CLARO_TV_YYYYMM AS --ALTERAR PARA O MÊS DE FECHAMENTO---SELECT * FROM INTCOB_CAR_CLARO_TV_ATU--PONTUAL-- 8) DELETE INTCOB_CAR_CLARO_TV_HST_AGG WHERE DT_FOTO = '01/11/2015' ---- Alterar a data!!!---COMMITDROP TABLE INTCOB_CAR_CLARO_TV_ATU_TMPCREATE TABLE INTCOB_CAR_CLARO_TV_ATU_TMP ASSELECT CTV.NUM_CONTRATO,MIN(TO_DATE(CTV.DT_VENCIMENTO,'DD/MM/YYYY')) MIN_DT_VENCIMENTO FROM INTCOB_CAR_CLARO_TV_ATU CTV WHERE TRUNC(TO_DATE(CTV.DT_FOTO,'DD/MM/YYYY')) = '12/02/2017'GROUP BYCTV.NUM_CONTRATOINSERT INTO INTCOB_CAR_CLARO_TV_HST_AGG SELECTDT_FOTO, 'AGING_FATURA' TIPO,CASE WHEN DT_INCLUSAO_WRITE_OFF IS NULL THEN 'R' ELSE 'W' END WO_IND,CASE WHEN TO_DATE(CF.DT_INCLUSAO_WRITE_OFF,'DD/MM/YYYY') >= '01/02/2017' AND  TO_DATE(CF.DT_INCLUSAO_WRITE_OFF,'DD/MM/YYYY') < '01/03/2017' THEN 'S' ELSE 'N' END  IND_WO_MES, CASE WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) < 1 THEN '001 - A Vencer'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 1   AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=30  THEN '002 - 1 a 30 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 31  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=60  THEN '003 - 31 a 60 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 61  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=90  THEN '004 - 61 a 90 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 91  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=120 THEN '005 - 91 a 120 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 121 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=150 THEN '006 - 121 a 150 dias'           WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 151 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=180 THEN '007 - 151 a 180 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 181 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=210 THEN '008 - 181 a 210 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 211 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=240 THEN '009 - 211 a 240 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 241 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=270 THEN '010 - 241 a 270 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 271 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=300 THEN '010 - 271 a 300 dias'            WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 301 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=330 THEN '012 - 301 a 330 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 331 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=360 THEN '013 - 331 a 360 dias'                          WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >  360  THEN '014 - acima de 360 dias' ELSE 'XXX' END AGING, CASE WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') < 1 THEN '001 - A Vencer'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 1   AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=30  THEN '002 - 1 a 30 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 31  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=60  THEN '003 - 31 a 60 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 61  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=90  THEN '004 - 61 a 90 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 91  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=120 THEN '005 - 91 a 120 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 121 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=150 THEN '006 - 121 a 150 dias'           WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 151 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=180 THEN '007 - 151 a 180 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 181 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=210 THEN '008 - 181 a 210 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 211 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=240 THEN '009 - 211 a 240 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 241 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=270 THEN '010 - 241 a 270 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 271 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=300 THEN '010 - 271 a 300 dias'            WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 301 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=330 THEN '012 - 301 a 330 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 331 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=360 THEN '013 - 331 a 360 dias'                          WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >  360  THEN '014 - acima de 360 dias' ELSE 'XXX' END AGING_OLD,           SUM(CF.VALOR_MULTA_JUROS) VALOR_MULTA_JUROS,      SUM(CF.VALOR) VALOR,      COUNT(DISTINCT CF.NUM_CONTRATO) QTD_CONTRATOS      FROM  INTCOB_CAR_CLARO_TV_ATU CFWHERE DT_FOTO = '12/02/2017' AND (DT_INCLUSAO_WRITE_OFF <> '238904777' OR DT_INCLUSAO_WRITE_OFF IS NULL)      GROUP BYCASE WHEN DT_INCLUSAO_WRITE_OFF IS NULL THEN 'R' ELSE 'W' END,CASE WHEN TO_DATE(CF.DT_INCLUSAO_WRITE_OFF,'DD/MM/YYYY') >= '01/02/2017' AND  TO_DATE(CF.DT_INCLUSAO_WRITE_OFF,'DD/MM/YYYY') < '01/03/2017' THEN 'S' ELSE 'N' END,     DT_FOTO,        CASE WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) < 1 THEN '001 - A Vencer'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 1   AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=30  THEN '002 - 1 a 30 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 31  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=60  THEN '003 - 31 a 60 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 61  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=90  THEN '004 - 61 a 90 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 91  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=120 THEN '005 - 91 a 120 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 121 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=150 THEN '006 - 121 a 150 dias'           WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 151 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=180 THEN '007 - 151 a 180 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 181 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=210 THEN '008 - 181 a 210 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 211 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=240 THEN '009 - 211 a 240 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 241 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=270 THEN '010 - 241 a 270 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 271 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=300 THEN '010 - 271 a 300 dias'            WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 301 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=330 THEN '012 - 301 a 330 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >= 331 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) <=360 THEN '013 - 331 a 360 dias'                          WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY')) >  360  THEN '014 - acima de 360 dias' ELSE 'XXX' END, CASE WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') < 1 THEN '001 - A Vencer'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 1   AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=30  THEN '002 - 1 a 30 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 31  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=60  THEN '003 - 31 a 60 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 61  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=90  THEN '004 - 61 a 90 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 91  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=120 THEN '005 - 91 a 120 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 121 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=150 THEN '006 - 121 a 150 dias'           WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 151 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=180 THEN '007 - 151 a 180 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 181 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=210 THEN '008 - 181 a 210 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 211 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=240 THEN '009 - 211 a 240 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 241 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=270 THEN '010 - 241 a 270 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 271 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=300 THEN '010 - 271 a 300 dias'            WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 301 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=330 THEN '012 - 301 a 330 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >= 331 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') <=360 THEN '013 - 331 a 360 dias'                          WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))) - TO_DATE(CF.DT_VENCIMENTO,'DD/MM/YYYY') >  360  THEN '014 - acima de 360 dias' ELSE 'XXX' ENDUNION ALLSELECTDT_FOTO, 'AGING_CLIENTE' TIPO,CASE WHEN DT_INCLUSAO_WRITE_OFF IS NULL THEN 'R' ELSE 'W' END WO_IND,CASE WHEN TO_DATE(CF.DT_INCLUSAO_WRITE_OFF,'DD/MM/YYYY') >= '01/02/2017' AND  TO_DATE(CF.DT_INCLUSAO_WRITE_OFF,'DD/MM/YYYY') < '01/03/2017' THEN 'S' ELSE 'N' END  IND_WO_MES, CASE WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) < 1 THEN '001 - A Vencer'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 1   AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=30  THEN '002 - 1 a 30 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 31  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=60  THEN '003 - 31 a 60 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 61  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=90  THEN '004 - 61 a 90 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 91  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=120 THEN '005 - 91 a 120 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 121 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=150 THEN '006 - 121 a 150 dias'           WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 151 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=180 THEN '007 - 151 a 180 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 181 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=210 THEN '008 - 181 a 210 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 211 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=240 THEN '009 - 211 a 240 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 241 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=270 THEN '010 - 241 a 270 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 271 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=300 THEN '010 - 271 a 300 dias'            WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 301 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=330 THEN '012 - 301 a 330 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 331 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=360 THEN '013 - 331 a 360 dias'                          WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >  360  THEN '014 - acima de 360 dias' ELSE 'XXX' END AGING, CASE WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO < 1 THEN '001 - A Vencer'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 1   AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=30  THEN '002 - 1 a 30 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 31  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=60  THEN '003 - 31 a 60 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 61  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=90  THEN '004 - 61 a 90 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 91  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=120 THEN '005 - 91 a 120 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 121 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=150 THEN '006 - 121 a 150 dias'           WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO>= 151 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=180 THEN '007 - 151 a 180 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 181 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=210 THEN '008 - 181 a 210 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 211 AND  LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=240 THEN '009 - 211 a 240 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 241 AND  LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=270 THEN '010 - 241 a 270 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 271 AND  LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=300 THEN '010 - 271 a 300 dias'            WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 301 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO<=330 THEN '012 - 301 a 330 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO>= 331 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=360 THEN '013 - 331 a 360 dias'                          WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >  360  THEN '014 - acima de 360 dias' ELSE 'XXX' END AGING_OLD,            SUM(CF.VALOR_MULTA_JUROS) VALOR_MULTA_JUROS,      SUM(CF.VALOR) VALOR,      COUNT(DISTINCT CF.NUM_CONTRATO) QTD_CONTRATOS      FROM INTCOB_CAR_CLARO_TV_ATU CF,       INTCOB_CAR_CLARO_TV_ATU_TMP TWHERE DT_FOTO = '12/02/2017' AND (DT_INCLUSAO_WRITE_OFF <> '238904777' OR DT_INCLUSAO_WRITE_OFF IS NULL)     AND CF.NUM_CONTRATO = T.NUM_CONTRATO      GROUP BYCASE WHEN DT_INCLUSAO_WRITE_OFF IS NULL THEN 'R' ELSE 'W' END,CASE WHEN TO_DATE(CF.DT_INCLUSAO_WRITE_OFF,'DD/MM/YYYY') >= '01/02/2017' AND  TO_DATE(CF.DT_INCLUSAO_WRITE_OFF,'DD/MM/YYYY') < '01/03/2017' THEN 'S' ELSE 'N' END,     DT_FOTO,        CASE WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) < 1 THEN '001 - A Vencer'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 1   AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=30  THEN '002 - 1 a 30 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 31  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=60  THEN '003 - 31 a 60 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 61  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=90  THEN '004 - 61 a 90 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 91  AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=120 THEN '005 - 91 a 120 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 121 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=150 THEN '006 - 121 a 150 dias'           WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 151 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=180 THEN '007 - 151 a 180 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 181 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=210 THEN '008 - 181 a 210 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 211 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=240 THEN '009 - 211 a 240 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 241 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=270 THEN '010 - 241 a 270 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 271 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=300 THEN '010 - 271 a 300 dias'            WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 301 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=330 THEN '012 - 301 a 330 dias'      WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >= 331 AND (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) <=360 THEN '013 - 331 a 360 dias'                          WHEN (TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY'))-1 - T.MIN_DT_VENCIMENTO) >  360  THEN '014 - acima de 360 dias' ELSE 'XXX' END, CASE WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO < 1 THEN '001 - A Vencer'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 1   AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=30  THEN '002 - 1 a 30 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 31  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=60  THEN '003 - 31 a 60 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 61  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=90  THEN '004 - 61 a 90 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 91  AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=120 THEN '005 - 91 a 120 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 121 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=150 THEN '006 - 121 a 150 dias'           WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO>= 151 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=180 THEN '007 - 151 a 180 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 181 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=210 THEN '008 - 181 a 210 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 211 AND  LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=240 THEN '009 - 211 a 240 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 241 AND  LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=270 THEN '010 - 241 a 270 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 271 AND  LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=300 THEN '010 - 271 a 300 dias'            WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >= 301 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO<=330 THEN '012 - 301 a 330 dias'      WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO>= 331 AND LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO <=360 THEN '013 - 331 a 360 dias'                          WHEN LAST_DAY(TRUNC(TO_DATE(DT_FOTO,'DD/MM/YYYY')))- T.MIN_DT_VENCIMENTO >  360  THEN '014 - acima de 360 dias' ELSE 'XXX' END       COMMIT        EXIT--=================================================================--USAR RANK RANK_DENSE--=================================================================  SELECT d.department_name, e.last_name, e.salary, DENSE_RANK()    OVER (PARTITION BY e.department_id ORDER BY e.salary) AS drank   FROM employees e, departments d   WHERE e.department_id = d.department_id   AND d.department_id IN ('30', '40');DEPARTMENT_NAME         LAST_NAME              SALARY      DRANK----------------------- ------------------ ---------- ----------Purchasing              Colmenares               2500          1Purchasing              Himuro                   2600          2Purchasing              Tobias                   2800          3Purchasing              Baida                    2900          4Purchasing              Khoo                     3100          5Purchasing              Raphaely                11000          6Human Resources         Marvis                   6500  ---=================================================================================-- acessos a Claro Móvel e NET-- REGRA ALINHADA COM DIEGO (DIGITAL) TODOS OS CLIENTES QUE EM 24 HORAS NÃO REALIZAM LIGAÇÕES---=================================================================================WITH       ACESSOS_RESIDENCIAL AS                                                                                (SELECT         /*+PARALLEL (12)*/                                                         SK_DATA,                                                         COUNT(*) AS QTD_ACSS_TV                                                                                                        FROM INN.DW_IDM_LOG A                                                   WHERE SK_DATA >= TO_NUMBER(&DATA_INICIAL)                                                     AND SK_DATA <= TO_NUMBER(&DATA_FINAL)                                                     AND UPPER(CLIENT_ID) LIKE '%TV%'                                                     GROUP BY                                                     SK_DATA),                                                            ACESSOS_MOVEL AS                                         (SELECT /*+ PARALLEL (32)*/                                         TO_NUMBER(TO_CHAR(DAT_INICIO_ATENDIMENTO, 'RRRRMMDD')) SK_DATA,                                         COUNT(*) AS QTD_ACSS_CMV                                  FROM DWH.BI_FP_ASSINANTE_ATEND_FECHADO@BASECLARO A                                         WHERE DW_METODO_CONTATO IN (81, 411, 451,681,701,552)                                               AND DAT_INICIO_ATENDIMENTO BETWEEN TO_DATE(&DATA_INICIAL, 'RRRRMMDD') AND  TO_DATE(&DATA_FINAL, 'RRRRMMDD')                                             -- NOVO FILTRO  -- SOMENTE USUÁRIOS QUE AUTENTICARAM -- EX: MinhaClaroWebPF: Autenticação de usuário                                                AND UPPER(A.DSC_OBSERVACAO_ATENDIMENTO) LIKE '%MINHACLAROWEB%AUTENTICA%USU%'                                          GROUP BY                                              TO_NUMBER(TO_CHAR(DAT_INICIO_ATENDIMENTO, 'RRRRMMDD')))       SELECT         A.SK_DATA,        A.QTD_ACSS_TV,        B.QTD_ACSS_CMVFROM ACESSOS_RESIDENCIAL AFULL OUTER JOIN ACESSOS_MOVEL BON A.SK_DATA = B.SK_DATAORDER BY SK_DATA---=================================================================================-- Conteúdo do cotidiano e gratuito de tecnologia em Banco de dados, Servidores Windows, Linux, BSD e Desenvolvimento em PL/SQL.---http://blog.gaudencio.net.br/2013/08/oracle-comandos-uteis-para-oracle.html---=================================================================================-- VERIFICA INSTANCIA (IDENTIFICAR NOME DA INSTANCIA E INFORMAÇÕES DA MESMA)SELECT * FROM GLOBAL_NAMESELECT * FROM V$INSTANCE--VERSAO DO ORACLE (VERIFICAR QUAL É A VERSAO DO ORACLE)SELECT VERSION FROM V$INSTANCE-- VERIFICAR QUAIS SÃO OS USUÁRIOS DO SISTEMA (VERIFICAR TODOS OS USUÁRIOS EXISTENTES)SELECT * FROM DBA_USERS-- CONTA OBJETOS DO SCHEMA (CONTA E LISTA TODOS OS TIPOS DE OBJETOS COM UM OWNER ESPECÍFICO)SELECT COUNT(OBJECT_TYPE), OBJECT_TYPEFROM DBA_OBJECTSWHERE OWNER LIKE 'RM%'GROUP BY OBJECT_TYPE-- VERIFICA ATRIBUTOS DO USUÁRIO (ATRIBUTOS GERAIS DE USUÁRIOS)SELECT * FROM DBA_USERSWHERE USERNAME LIKE 'RM%'SELECT * FROM DBA_TAB_PRIVSWHERE GRANTOR LIKE 'RM%'-- VERIFICA PREVILEGIOS DO USUÁRIOSELECT * FROM DBA_SYS_PRIVSWHERE GRANTEE LIKE 'RM%'SELECT * FROM DBA_ROLE_PRIVSWHERE GRANTEE LIKE 'RM%'-- DESATIVA USUÁRIO / ATIVAALTER USER USER RM ACCOUNT LOCKALTER USER USER RM ACCOUNT UNLOCKALTER USER USER RM PASSWORD EXPIRE-- VERIFICA STATUS DA CONTASELECT USERNAME, ACCOUNT_STATUS FROM DBA_USERS-- VERIFICAR SE TEM ALGUM USUÁRIO USANDO O SISTEMA (BOM CASO DESEJE PARAR O SERVICO DO ORACLE SERVER)SELECT SADDR, SID, USERNAME, LOGON_TIME, STATUS,OSUSER, MACHINE, PROGRAMFROM V$SESSION-- VERIFICA PREVILEGIOS DE ROLESELECT * FROM DBA_ROLE_PRIVS-- CONTA OBJETOS DO SCHEMASELECT COUNT(OBJECT_TYPE), OBJECT_TYPEFROM DBA_OBJECTSGROUP BY OBJECT_TYPE-- CONTA OBJETOS DE UM SCHEMA ESPECÍFICOSELECT COUNT(OBJECT_TYPE), OBJECT_TYPEFROM DBA_OBJECTSWHERE OWNER LIKE 'RM%'GROUP BY OBJECT_TYPE-- CONTA OBJETOS INVALIDOSSELECT COUNT (*)FROM DBA_OBJECTSWHERE STATUS='INVALID'AND OWNER LIKE 'RM%'-- VERIFICA OBJETOS INVALIDOSSELECT OBJECT_TYPE, OBJECT_NAME, STATUSFROM DBA_OBJECTSWHERE STATUS='INVALID'AND OWNER LIKE 'RM%'-- GERA SCRIPTS DOS OBJETOS INVALIDOSSELECT 'ALTER'||' '|| OBJECT_TYPE ||' '||OWNER ||'.'|| OBJECT_NAME || ' COMPILE'FROM DBA_OBJECTSWHERE STATUS='INVALID'AND OWNER LIKE 'RM%'-- VERIFICA AS ROLES RMSELECT * FROM DBA_ROLES WHERE ROLE LIKE '%RM%'SELECT * FROM DBA_SYS_PRIVS WHERE LIKE '%RM%'--ALTERAR SENHA DE USUARIOALTER USER USER RM IDENTIFIED BY 'NOVA_SENHA'--PROPRIEDADES DO SERVER (lANGUAGE, CHARACTER SET E ETC..)SELECT * FROM NLS_DATABASE_PARAMETERS--PROPRIEDADES DA SESSAO (lANGUAGE, CHARACTER SET E ETC..)SELECT * FROM NLS_SESSION_PARAMETERS--MOSTRA INFORMÇÕES GERAIS DA PARAMETRIZAÇÃO (NÃO FUNCIONA NO SQL TOOLS)SHOW PARAMETERS--VERIFICAR TRIGGERS NA BASESELECT * FROM DBA_TRIGGERS WHERE TABLE_OWNER='RM'/*--========================================================================================================================--                              PEDIDO DA FRANCINE: ACESSOS DOS CLIENTES RELATIVOS AO PS8CONSULTA COM LIMETE DE LINHAS/ROWS --  BRIEFING:-- HISTÓRICO DOS ULTIMOS 6 MESES -- DE 200 CLIENTES RELATIVO AOS-- PRODUTOS PRÉ PAGO/CONTROLE/PÓS-- DDD41                            -- 11980185386 NTC_FLEX TENTOU ACESSAR MINHA CLARO--========================================================================================================================*/--SELECT COUNT (DISTINCT NUM_NTC || TO_CHAR(DT_INI_ATENDIMENTO,'RRRRMMDD HH24MISS'))  AS QTD_ACESSOS -- 1.546.851--SELECT *  FROM INN.EXT_ADMINSITE--SELECT *  FROM INN.EXT_ADMINSITE WHERE TRIM(SUBSTR(NM_DESC_PEDIDO,INSTR(NM_DESC_PEDIDO,'|origem:')+8)) IN ('NETAPP','MINHANET','MEUTECNICO','BOT','NETAPPNOVO','MIND')--SELECT * FROM BI_DIM_MOTIVO_ATENDIMENTO---SELECT * FROM ALL_ALL_TABLES WHERE OWNER LIKE 'DWH' AND TABLE_NAME LIKE '%HIS%ASS%'WITH BASE1 AS(SELECT /*PARALELL (32)*/                  SUBSTR(TO_CHAR(A.DAT_INICIO_ATENDIMENTO, 'RRRRMMDD'),1,6) AS SAFRA         ,A.NUM_NTC         ,SUBSTR(A.NUM_NTC,1,2) AS DDD         ,HIS.COD_AREA         ,MIN(TO_DATE(TO_CHAR(A.DAT_INICIO_ATENDIMENTO, 'RRRRMMDD')||' '||HOR_INICIO_ATENDIMENTO,'RRRRMMDD HH24MISS')) DT_PRI_ATEND         ,HIS.COD_PLATAFORMA_ATU         /*,regexp_replace(TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_1,'00000')||                                  TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_2,'00000')||                                   TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_3,'00000'),'[[:space:]]*','')||                         (CASE WHEN MA.COD_MOTIVO_ATEND_NIVEL_4 = -3 THEN '00000'                                ELSE (regexp_replace(TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_4,'00000'),'[[:space:]]*',''))END)||                          (CASE WHEN MA.COD_MOTIVO_ATEND_NIVEL_5 = -3 THEN '00000'                                 ELSE (regexp_replace(TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_5,'00000'),'[[:space:]]*',''))END)                                      AS ID_MOTIVOS_TUPLA*/                                                                          FROM DWH.BI_FP_ASSINANTE_ATEND_FECHADO AINNER JOIN BI_DIM_METODO_CONTATO MT             ON A.DW_METODO_CONTATO = MT.DW_METODO_CONTATOLEFT JOIN BI_DIM_MOTIVO_ATENDIMENTO MA          ON A.DW_MOTIVO_ATENDIMENTO = MA.DW_MOTIVO_ATENDIMENTOLEFT JOIN BI_HIS_ASSINANTE HIS                  ON A.NUM_NTC = HIS.NUM_NTC                                                 AND SUBSTR(TO_CHAR(A.DAT_INICIO_ATENDIMENTO,'RRRRMMDD'),1,6) = SUBSTR(TO_CHAR(HIS.DAT_MOVIMENTO,'RRRRMMDD'),1,6)      WHERE  A.DW_METODO_CONTATO IN (81, 411, 451,701) --EXPURGO 681 FLEX, 552 Minha Claro Empresa     AND UPPER(A.DSC_OBSERVACAO_ATENDIMENTO) LIKE '%MINHACLAROWEB%AUTENTICA%USU%' ---SOMENTE ACESSO                                                   AND SUBSTR(A.NUM_NTC,1,2) LIKE '41' ---- DDD QUE A FRANCINE SOLICITOU     AND A.DAT_INICIO_ATENDIMENTO BETWEEN TO_DATE(&DATA_INICIAL, 'RRRRMMDD') AND  TO_DATE(&DATA_FINAL, 'RRRRMMDD')      AND HIS.DAT_MOVIMENTO BETWEEN TO_DATE(&DATA_INICIAL, 'RRRRMMDD') AND  TO_DATE(&DATA_FINAL, 'RRRRMMDD')      GROUP BY SUBSTR(TO_CHAR(A.DAT_INICIO_ATENDIMENTO, 'RRRRMMDD'),1,6)          ,A.NUM_NTC         ,SUBSTR(A.NUM_NTC,1,2)         ,HIS.COD_AREA          ,TO_DATE(TO_CHAR(A.DAT_INICIO_ATENDIMENTO, 'RRRRMMDD')||' '||HOR_INICIO_ATENDIMENTO,'RRRRMMDD HH24MISS')         ,HIS.COD_PLATAFORMA_ATU        /* ,regexp_replace(TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_1,'00000')||                                  TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_2,'00000')||                                   TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_3,'00000'),'[[:space:]]*','')||                         (CASE WHEN MA.COD_MOTIVO_ATEND_NIVEL_4 = -3 THEN '00000'                                ELSE (regexp_replace(TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_4,'00000'),'[[:space:]]*',''))END)||                          (CASE WHEN MA.COD_MOTIVO_ATEND_NIVEL_5 = -3 THEN '00000'                                 ELSE (regexp_replace(TO_CHAR(MA.COD_MOTIVO_ATEND_NIVEL_5,'00000'),'[[:space:]]*',''))END) */                                      ),BASE2A AS (SELECT * FROM BASE1 WHERE ROWNUM < 201 AND COD_PLATAFORMA_ATU = 'PREPG'),BASE2B AS (SELECT * FROM BASE1 WHERE ROWNUM < 201 AND COD_PLATAFORMA_ATU = 'AUTOC'),BASE2C AS (SELECT * FROM BASE1 WHERE ROWNUM < 201 AND COD_PLATAFORMA_ATU        IN ('POSBC','POSBL','POSCM','POSCP','POSDT','POSFX','POSPG','POSRI')),BASE3 AS (SELECT * FROM BASE2AUNION ALLSELECT * FROM BASE2B),BASE4 AS (SELECT * FROM BASE2CUNION ALLSELECT * FROM BASE3)SELECT * FROM BASE4/*--=================================================================================================================================		COMO UTILIZAR A FUNÇÃO --> DW_NUM_CANAL_MINT	--=================================================================================================================================*/WITH BI_DIM_MENU_MINT_EXPURGO AS (SELECT C.*      ,CASE WHEN REGEXP_SUBSTR (UPPER(C.DSC_MENU_MINT), 'VOLTAR') = 'VOLTAR'            OR NVL(C.DSC_MENU_MINT,'-3') = '-3' THEN 1 ELSE 0 END AS FLG_EXPURGOFROM DWH.BI_DIM_MENU_MINT C WHERE (CASE WHEN REGEXP_SUBSTR (UPPER(C.DSC_MENU_MINT), 'VOLTAR') = 'VOLTAR'            OR NVL(C.DSC_MENU_MINT,'-3') = '-3' THEN 1 ELSE 0 END) = 0           --> TOTAL GERAL LINE 1.446--> TOTAL VAZIO 45--> TOTAL CONTEM 'VOLTAR' 423--> TT LOQUIDO 978  EM 22/05/2020),MOTIVOS_P1 AS(SELECT /*+ PARELLEL (32)*/       SUBSTR(TO_CHAR(A.DAT_INICIO_ATENDIMENTO, 'YYYYMMDD'),1,6) AS SAFRA        ,A.COD_PLATAFORMA       ,A.NUM_NTC       ,A.DAT_INICIO_ATENDIMENTO       ,C.DSC_MENU_MINT       ,NVL2(C.DSC_MENU_MINT,1,0) AS FLG_DSC_MENU_MINT       ,COUNT(*) QT_TRANSACOES--     SELECT *  FROM DWH.BI_FP_ATENDIMENTO_MINT ALEFT JOIN BI_DIM_MENU_MINT_EXPURGO C  ON A.DW_NUM_CANAL_MINT = C.DW_NUM_CANAL_MINTWHERE A.COD_SHORT_CODE = 9652 --- SHORT CODE WPPAND ROWNUM < 501---AND NVL2(C.DSC_MENU_MINT,0,1) = 0AND A.COD_PLATAFORMA = 'PREPG'AND A.DAT_INICIO_ATENDIMENTO BETWEEN TO_DATE(&DATA_INICIAL, 'RRRRMMDD') AND  TO_DATE(&DATA_FINAL, 'RRRRMMDD')AND COD_PLATAFORMA NOT IN ('-1', '-2', '-3')GROUP BY         SUBSTR(TO_CHAR(A.DAT_INICIO_ATENDIMENTO, 'YYYYMMDD'),1,6)        ,A.COD_PLATAFORMA       ,A.NUM_NTC       ,A.DAT_INICIO_ATENDIMENTO       ,C.DSC_MENU_MINT)SELECT * FROM MOTIVOS_P1 WHERE FLG_DSC_MENU_MINT = 1 ORDER BY NUM_NTC;